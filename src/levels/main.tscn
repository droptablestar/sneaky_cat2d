[gd_scene format=3]

; External dependencies
[ext_resource type="PackedScene" path="res://src/player/Player.tscn" id="1_player"]
[ext_resource type="Script" path="res://src/levels/camera_follow.gd" id="2_camera_follow"]

; Physics resource for the floor collision (continuous across both rooms)
[sub_resource type="RectangleShape2D" id="RectangleShape2D_1"]
size = Vector2(2600, 40)

; Solid 1x1 texture used as a canvas for the wallpaper shader
[sub_resource type="Gradient" id="Gradient_1"]
offsets = PackedFloat32Array(0, 1)
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_1"]
gradient = SubResource("Gradient_1")
width = 1
height = 1

; Wallpaper dots shader: subtle, clean, non-foggy.
; Pattern is based on Sprite UVs, so it scrolls as the camera moves.
[sub_resource type="Shader" id="Shader_1"]
code = "shader_type canvas_item;\n\nuniform float dot_spacing = 28.0; // pixels-ish (relative to sprite UV scale)\nuniform float dot_radius  = 0.07; // in cell units (0..0.5)\nuniform float dot_alpha   = 0.08; // overall opacity\nuniform vec4  dot_color   : source_color = vec4(0.0, 0.0, 0.0, 1.0);\n\nvoid fragment() {\n\t// Use UVs to create a repeating grid; keep it stable in world space.\n\tvec2 uv = UV * dot_spacing;\n\tvec2 cell = fract(uv) - vec2(0.5);\n\tfloat d = length(cell);\n\tfloat mask = 1.0 - smoothstep(dot_radius, dot_radius + 0.02, d);\n\t// Very subtle: dots only.\n\tCOLOR = vec4(dot_color.rgb, mask * dot_alpha);\n}\n"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_1"]
shader = SubResource("Shader_1")
shader_parameter/dot_spacing = 34.0
shader_parameter/dot_radius = 0.085
shader_parameter/dot_alpha = 0.07
shader_parameter/dot_color = Color(0.0, 0.0, 0.0, 1.0)

[node name="Main" type="Node2D"]

; === ROOM A visuals (x: -640..640) ===
[node name="Wall_A" type="Polygon2D" parent="."]
z_index = -10
color = Color(0.22, 0.22, 0.22, 1.0)
polygon = PackedVector2Array(-640, 0, 640, 0, 640, 720, -640, 720)

; Wallpaper overlay for Room A (subtle dots)
[node name="Wallpaper_A" type="Sprite2D" parent="."]
z_index = -9
texture = SubResource("GradientTexture2D_1")
material = SubResource("ShaderMaterial_1")
position = Vector2(0, 360)
centered = true
scale = Vector2(1280, 720)

[node name="FloorVisual_A" type="Polygon2D" parent="."]
z_index = -6
color = Color(0.30, 0.25, 0.20, 1.0)
polygon = PackedVector2Array(-640, 400, 640, 400, 640, 720, -640, 720)

; === ROOM B visuals (x: 640..1920) ===
; Slightly different tint so the camera transition is obvious.
[node name="Wall_B" type="Polygon2D" parent="."]
z_index = -10
color = Color(0.20, 0.21, 0.23, 1.0)
polygon = PackedVector2Array(640, 0, 1920, 0, 1920, 720, 640, 720)

; Wallpaper overlay for Room B (same shader, same scale)
[node name="Wallpaper_B" type="Sprite2D" parent="."]
z_index = -9
texture = SubResource("GradientTexture2D_1")
material = SubResource("ShaderMaterial_1")
position = Vector2(1280, 360)
centered = true
scale = Vector2(1280, 720)

[node name="FloorVisual_B" type="Polygon2D" parent="."]
z_index = -6
color = Color(0.28, 0.24, 0.19, 1.0)
polygon = PackedVector2Array(640, 400, 1920, 400, 1920, 720, 640, 720)

; === Room boundary marker (visual seam) ===
[node name="RoomSeam" type="Line2D" parent="."]
z_index = -1
width = 2.0
default_color = Color(0.10, 0.10, 0.10, 1.0)
points = PackedVector2Array(640, 0, 640, 720)

; === Divider wall with doorway gap (visual only) ===
[node name="DividerWallTop" type="Polygon2D" parent="."]
z_index = -2
color = Color(0.14, 0.14, 0.14, 1.0)
polygon = PackedVector2Array(630, 0, 650, 0, 650, 280, 630, 280)

[node name="DividerWallBottom" type="Polygon2D" parent="."]
z_index = -2
color = Color(0.14, 0.14, 0.14, 1.0)
polygon = PackedVector2Array(630, 440, 650, 440, 650, 720, 630, 720)

; === Physics floor ===
[node name="Floor" type="StaticBody2D" parent="."]
position = Vector2(640, 400)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Floor"]
shape = SubResource("RectangleShape2D_1")

; Player
[node name="Player" parent="." instance=ExtResource("1_player")]
position = Vector2(200, 300)

; Camera (follows player X)
[node name="Camera2D" type="Camera2D" parent="."]
current = true
position = Vector2(0, 360)
script = ExtResource("2_camera_follow")
target_path = NodePath("../Player")
fixed_y = 360.0
